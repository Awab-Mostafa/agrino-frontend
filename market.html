<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Market Page</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/png" href="/favicon.png">
    <!-- Boxicons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  </head>

  <body>
    <!-- Header -->
    <header class="header">
      <a href="index.html" class="logo">Our <span>Project</span></a>
      <nav class="navbar">
        <a href="index.html#home">Home</a>
        <a href="index.html#about">About</a>
        <a href="index.html#services">SDGs</a>
        <a href="index.html#projects">Previous solutions</a>
        <a href="index.html#ourteam">Our Team</a>
      </nav>
      <div class="header-buttons">
        <button class="gradient-btn">
          <a href="index.html#contact" class="gradient-btn">Contact Us</a>
        </button>
      </div>
    </header>

    <!-- Market items section -->
    <section class="projects" id="market-items" style="padding-top: 10rem;">
      <h2 class="heading">Market Items</h2>
      <!-- هنا هنحقن الكروت ديناميك -->
      <div class="projects-box1" id="products-grid"></div>

      <!-- "My Products" button -->
      <div class="my-products-btn-container" style="text-align: center; margin-top: 3rem;">
        <button class="card-btn" onclick="window.location.href='products.html'">My Products</button>
      </div>
    </section>

    <footer class="footer">
      <p>&copy; 2025 Jonathan. All Rights Reserved.</p>
    </footer>

    <!-- سكريبت السلة (لازم يكون قبل كود التحميل عشان window.addToCart يبقى متاح) -->
    <script src="script.js"></script>

    <!-- تحميل المنتجات من Supabase -->
    <script type="module">
      import { supabase } from './supabaseClient.js';

      async function loadProducts(){
        const grid = document.getElementById('products-grid');
        grid.innerHTML = '<p style="color:#fff;margin:1rem 0;">Loading...</p>';

        const { data, error } = await supabase
          .from('products')
          .select('id, name, description, price, image_url, is_active')
          .eq('is_active', true)
          .order('created_at', { ascending: false });

        if (error){
          grid.innerHTML = '<p style="color:#ff6b6b">Error: ' + error.message + '</p>';
          return;
        }

        if (!data || data.length === 0){
          grid.innerHTML = '<p style="color:#ddd">No products available yet.</p>';
          return;
        }

        grid.innerHTML = '';
        data.forEach(p => {
          const card = document.createElement('div');
          card.className = 'projects-card1';
          card.innerHTML = `
            <div class="image-container">
              <img src="${p.image_url ?? ''}" alt="${p.name}" />
            </div>
            <h3>${p.name}</h3>
            <p>${p.description ?? ''}</p>
            <p class="price">Price: ${Number(p.price).toLocaleString('ar-EG')} EGP</p>
            <button class="card-btn">Add to cart</button>
          `;
          card.querySelector('button').addEventListener('click', () => {
            // بتخزّن مع المنتج الـUUID من الداتابيز
            window.addToCart(p.name, p.image_url, p.description, Number(p.price), p.id);
          });
          grid.appendChild(card);
        });
      }

      loadProducts();
    </script>
  </body>
</html>
